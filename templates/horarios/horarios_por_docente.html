{% extends "dashboard/index.html" %}
{% block titulo %} Horarios por docente {% endblock %}
{% block contenido %}
<script src="{{ url_for('static', filename='login/libs/sweetalert2/sweetalert2.js') }}"></script>
<style>
    /*INICIO ESTILOS DEL BUSCADOR*/
    #buscador-multiopcion-sugerencias{
        /* border: 1px #DEE2E6 solid;
        border-radius: 4px;

        &:active{
            border: 1px #9DBEEE solid;
            outline: 4px#CEDEF6 solid;
        } */
    }

    #bmos-barra-busqueda{
        height: max(auto,50px);
        width: 500px;
        background-color: white;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        padding-inline: 10px;
        border-radius: 10px;
        overflow-y: hidden;
        cursor: text;
    }
    
    #bmos-barra-busqueda .bmos-p{
        order: 2;
        pointer-events:fill;
        width: 100%;
        white-space: nowrap;
        /* margin: 0; */
        overflow-x: hidden;
        flex: 1 0 min(100%,20%);
        /*background-color: rgb(197, 197, 197);*/
    }

    #bmos-barra-busqueda p:focus-within{
        outline: none;
    }

    .bmos-etiqueta{
        background-color: rgb(217, 217, 217);
        padding: 6px;
        border-radius: 8px;
        margin: 3px;
        order: 1;
        flex: 0 1 auto;
    }

    .bmos-etiqueta:hover{
        background-color: rgb(185, 185, 185);
    }

    .bmos-etiqueta button{
        font-size: 20px;
        border: none;
        margin-left: 5px;
        margin-right: 0px;
        background-color: transparent;
        color: rgb(62, 62, 62);
    }

    #buscador-multiopcion-sugerencias.active #bmos-lista-sugerencias{
        display: block;
    }

    #buscador-multiopcion-sugerencias #bmos-lista-sugerencias{
        background-color: rgb(217, 217, 217);
        list-style: none;
        margin-top: 8px;
        border-radius: 10px;
        padding: 0px;
        overflow-y: hidden;
        display: none;
        position: absolute;
    }

    .bmos-sugerencia{
        padding: 11px;
        padding-left: 10px;
    }

    .bmos-sugerencia:hover{
        background-color: rgb(185, 185, 185);
    }
    /*FIN ESTILOS DEL BUSCADOR*/

    .texto-label{
        color: #70767F;
        text-transform: uppercase;
        font-weight: bold;
    }

    .texto-input{
        color: black;
    }

    .foot{
        background-color: black;
        border-color: black;
    }

    .foot:hover{
        background-color: black;
        border-color: black;
    }

    .foot:active{
        background-color: black;
        border-color: black;
    }

    @media (max-width: 570px) {
    #foto_perfil {
        display: none;
    }
    }

    #foto_perfil{
        max-height: 100px;
    }

</style>

<nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item" href="Home"><a>Inicio</a></li>
        <li class="breadcrumb-item active" data-href="#"><a>Horarios por docente</a></li>

    </ol>
</nav>


<div class="card mx-2" id="card_horarios">
    <div class="card-header bg-red-usat text-white" id="headingOne" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
        Horarios asignados por docente
    </div>
    <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-bs-parent="#miAccordion">
        <div class="card-body">
            <div class="container">
                <!-- Div superior -->
                <div class="row row align-items-end my-3">
                    <div class="col-md-10 order-md-1 order-sm-2">
                        <!-- Primer input y label -->
                        <div class="form-group row mb-3 d-flex justify-content-center">
                            <label for="combo_semestre" class="col-form-label col-12 col-sm-12 col-md-4 col-lg-3 col-xl-3 texto-label">Semestre académico:</label>
                            <div class="col-12 col-sm-12 col-md-8 col-lg-9 col-xl-9">
                                <select class="form-select" aria-label="Default select example" id="combo_semestre">
                                    <option selected>[-- SELECCIONE --]</option>
                                    {% for semestre in semestres %}
                                        <option value="{{semestre[1]}}">{{semestre[1]}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <!-- Segundo input y label -->
                        <div class="form-group row d-flex justify-content-center" style="align-items: center;">
                            <label for="search_bar" class="col-form-label col-12 col-sm-12 col-md-4 col-lg-3 col-xl-3 texto-label">Docente:</label>
                            <div class="col-12 col-sm-12 col-md-8 col-lg-9 col-xl-9">
                                <!-- Buscador con autocompletado de sugerencias -->
                                <div id="buscador-multiopcion-sugerencias" class="">
                                    <div id="bmos-barra-busqueda" contenteditable="false">
                                        <p class="bmos-p" contenteditable="true"></p>
                                    </div>
                                    <ul id="bmos-lista-sugerencias">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 order-md-2 order-sm-1  d-flex justify-content-center align-items-center">
                        <!-- Foto -->
                        <img src="/static/img/USUARIO.jpg" class="img-fluid" alt="Foto" id="foto_perfil">
                    </div>
                </div>
                <!-- Tabla inferior -->
                <div class="card-body show">
                    <div class="row mt-3">
                        <div class="col-md-12" id="espacio_tabla">
                            <table class="table table-bordered text-center" id="tabla_inicial">
                                <thead class="border border-warning bg-blue-horario-usat">
                                  <tr>
                                    <th scope="col" class="border border-warning text-light">Hora</th>
                                    <th scope="col" class="border border-warning text-light">Lunes</th>
                                    <th scope="col" class="border border-warning text-light">Martes</th>
                                    <th scope="col" class="border border-warning text-light">Miércoles</th>
                                    <th scope="col" class="border border-warning text-light">Jueves</th>
                                    <th scope="col" class="border border-warning text-light">Viernes</th>
                                    <th scope="col" class="border border-warning text-light">Sábado</th>
                                    <th scope="col" class="border border-warning text-light">Domingo</th>
                                  </tr>
                                </thead>
                                <tbody class="" style="background-color: #EEEEEE;">
                                    <tr>
                                        <th scope="row">X</th>
                                        <th scope="row">X</th>
                                        <th scope="row">X</th>
                                        <th scope="row">X</th>
                                        <th scope="row">X</th>
                                        <th scope="row">X</th>
                                        <th scope="row">X</th>
                                        <th scope="row">X</th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div href="#" id="" data-href="" class="btn btn-success foot" style="height: 20px;"></div>
</div>


<script>
        let bmos_lista_datos = [];

        function mostrarAlerta(icon, title, text) {
            Swal.fire({
                icon: icon,
                title: title,
                text: text
            });
        }

        function mostrarFoto(nombre_foto) {
            nombre_foto = nombre_foto.toUpperCase().replace(/ /g, "_");
            nombre_formateado = nombre_foto.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            var img = new Image();
            img.src = "/static/img/" + nombre_formateado + ".jpg";

            img.onload = function() {
                document.getElementById("foto_perfil").src = img.src;
            };
            
            img.onerror = function() {
                document.getElementById("foto_perfil").src = "/static/img/USUARIO.jpg";
            };
        }

        function obtener_docentes() {
            fetch('/get_personas_activas', {
            headers: {
                'Content-Type': 'application/json'
            },
            })
            .then(response => response.json())
            .then(data => {
                bmos_lista_datos = data;
                
            })
            .catch(error => {
            console.error('Error:', error);
            });
        } 

    $(document).ready(function(){
        obtener_docentes();
        $('#collapseOne').collapse('show');
    });
    
    

    /*INICIO SCRIPT BUSCADOR*/

    const bmos_contenedor = document.querySelector("#buscador-multiopcion-sugerencias");
    const bmos_barra_busqueda = document.querySelector("#bmos-barra-busqueda");
    const bmos_etiquetas_busqueda = bmos_barra_busqueda.querySelectorAll(".bmos-etiqueta");
    const bmos_input = bmos_barra_busqueda.querySelector("p");
    const bmos_lista_sugerencias = document.querySelector("#bmos-lista-sugerencias");
    

    bmos_input.onkeyup = (event) => {
        let datos_entrada = bmos_input.textContent;
        let datos_salida = [];

        if(datos_entrada.length){
            bmos_contenedor.classList.add("active");
            datos_salida = generar_sugerencias(datos_entrada);
            datos_filtrados = filtrar_sugerencias(datos_salida);
            mostrar_sugerencias(datos_filtrados);

        }else{
            bmos_contenedor.classList.remove("active");
        }
    };

    function generar_sugerencias(dato) {
    let datos_salida = [];
    bmos_lista_datos.forEach(element => {
        var nombre = element[2] + " " + element[1];
        var id = element[0];

        if (nombre.toLowerCase().trim().includes(dato.toLowerCase().trim())) {
            datos_salida.push([id, nombre]);
        }
    });
    return datos_salida;
}


    function mostrar_sugerencias(lista){
        bmos_lista_sugerencias.innerHTML = "";
        lista.forEach(element => {
            bmos_lista_sugerencias.innerHTML += 
            `<li class="bmos-sugerencia" onclick="insertar_etiqueta(this);"
             id="${element[0]}">${element[1]}</li>`;
        });
    }

    function insertar_etiqueta(element){
        bmos_input.textContent = "";
        bmos_contenedor.classList.remove("active");
        var nuevoSpan = document.createElement("span");
        nuevoSpan.className = "bmos-etiqueta";
        nuevoSpan.setAttribute("contenteditable", "false");
        nuevoSpan.setAttribute("id",`${element.id}`);
        nuevoSpan.innerHTML = `${element.textContent}<button>X</button>`;
        nuevoSpan.onclick = function() {
            eliminarEtiqueta(nuevoSpan);
        };
        bmos_barra_busqueda.appendChild(nuevoSpan);
        bmos_input.focus();
    }

    function eliminarEtiqueta(element){
        element.remove();
    }
    
    function filtrar_sugerencias(lista_sugerencias){
        if (!Array.isArray(lista_sugerencias)) {
            console.error("Error: lista_sugerencias no es un array.");
            return [];
        }

        let lista_sugerencias_2 = lista_sugerencias.map(function(elements){
            return elements[1];
        });
        bmos_barra_busqueda.querySelectorAll('.bmos-etiqueta').forEach(etiqueta =>{
            var sugerencia = (etiqueta.textContent).slice(0,-1);

            indice = lista_sugerencias_2.indexOf(sugerencia);
            if(indice>=0){
                console.log(sugerencia + " si está seleccionado");
                lista_sugerencias.splice(indice,1);
            }
        });
        return lista_sugerencias;
    }

    bmos_barra_busqueda.addEventListener("click",()=>{
        bmos_input.focus();
    });


    bmos_barra_busqueda.addEventListener("keydown",function(event){
        if(event.key === "Enter"){
            event.preventDefault();
        }
    });
    /*FIN SCRIPT BUSCADOR*/


    


</script>

{% endblock %}